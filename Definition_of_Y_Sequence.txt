<div style="display:none"><math>
  \newcommand{\ordinarycolon} {:}
  \newcommand{\vcentcolon}{\mathrel{\mathop\ordinarycolon}}
  \newcommand{\coloneqq}{\vcentcolon\mathrel{\mkern-1.2mu}=}
</math></div>

'''Y数列'''を数式で定義する。この定義は圧縮・展開・解凍の三段階を使っている。また、圧縮／解凍の形式は D (difference), P (parent), N (depth) の三行で構成された形式（DPN形式と名付けた）を使っている。

== 汎用関数／表記 ==

<math>
  \begin{eqnarray*}
  x ^ - & \coloneqq & x - 1 \\
  \mathbb{N} ^ + & \coloneqq & \{ x \in \mathbb{N} \mid x \neq 0 \} \\
  [ x, \ldots, y ] & \coloneqq &
    \begin{cases}
      [ ]                               & ( x >    y ) \\
      [ x ] \frown [ x ^ -, \ldots, y ] & ( x \leq y ) \\
    \end{cases} \\
</math>

リスト版の内包表記も使っているが、定義を書ききる自信はないので Haskell でのリスト内包表記の動作を参考にしてほしい。

== 極限形 ==

ここでは <math> S </math> という'''極限形'''の数列の展開を定義する数式を与える。

=== 圧縮 ===

山を構成する部分。

<math>
  \begin{eqnarray*}
    S & = & ( S _ 1, S _ 2, \ldots, S _ X ) \\
    D _ S ( x, n ) & \coloneqq &
      \begin{cases}
        S _ x                                                    & ( n = 1                              ) \\
        0                                                        & ( n > 1 \land P _ S ( x, n ^ - ) = 0 ) \\
        D _ S ( x, n ^ - ) - D _ S ( P _ S ( x, n ^ - ), n ^ - ) & ( n > 1 \land P _ S ( x, n ^ - ) > 0 ) \\
      \end{cases} \\
    P _ S ( x, n ) & \coloneqq &
      \begin{cases}
        0                                                                                                              & ( n = 1 \land D _ S ( x, n ) = 1 ) \\
        \max \{ p \in \mathbb{N} ^ + \mid D _ S ( p, n ) < D _ S ( x, n ) \}                                           & ( n = 1 \land D _ S ( x, n ) > 1 ) \\
        0                                                                                                              & ( n > 1 \land D _ S ( x, n ) = 0 ) \\
        \max \{ p \in \mathbb{N} ^ + \mid D _ S ( p, n ) < D _ S ( x, n ) \land p \in \mathrm{Anc} _ S ( x, n ^ - ) \} & ( n > 1 \land D _ S ( x, n ) > 0 ) \\
      \end{cases} \\
    \mathrm{Anc} _ S ( x, n ) & \coloneqq &
      \begin{cases}
        \emptyset                                           & ( x = 0 ) \\
        \{ x \} \cup \mathrm{Anc} _ S ( P _ S ( x, n ), n ) & ( x > 0 ) \\
      \end{cases} \\
  \end{eqnarray*}
</math>

山をDPN形式へ圧縮する部分。

<math>
  \begin{eqnarray*}
    T _ S & \coloneqq & \max \{ n \in \mathbb{N} ^ + \mid D _ S ( X, n ) > 0 \} \\
    c _ S & \coloneqq & D _ S ( X, T _ S ) \\
    t _ S & \coloneqq &
      \begin{cases}
        { T _ S } ^ - & ( c _ S = 1 ) \\
        T _ S         & ( c _ S > 1 ) \\ 
      \end{cases} \\
    \mathrm{btm} _ S ( x ) & \coloneqq & \max \{ n \in \mathbb{N} ^ + \mid D _ S ( x, n ) > 0 \} \\
    d _ S ( x ) & \coloneqq & D _ S ( x, n _ S ( x ) ) \\
    p _ S ( x ) & \coloneqq & [ P _ S ( x, n ) \mid n \leftarrow [ u _ S ( x ), \ldots, v _ S ( x ) ] ] \\
    n _ S ( x ) & \coloneqq & \max ( \mathrm{btm} _ S ( x ), t _ S ) \\
    u _ S ( x ) & \coloneqq & \max \{ n \in \mathbb{N} ^ + \mid P _ S ( x, 1 ) = P _ S ( x, n ) \land n \leq n _ S ( x ) \} \\
    v _ S ( x ) & \coloneqq & n _ S ( x ) \\
  \end{eqnarray*}
</math>

DPN形式への圧縮を行う関数は以下のようになる。

<math>
  z ( S ) \coloneqq
    \left (
      \begin{array}{cccc}
        d _ S ( 1 ) & d _ S ( 2 ) & \cdots & d _ S ( X ) \\
        p _ S ( 1 ) & p _ S ( 2 ) & \cdots & p _ S ( X ) \\
        n _ S ( 1 ) & n _ S ( 2 ) & \cdots & n _ S ( X ) \\
      \end{array}
    \right )
</math>

また、付随して行列のクラスもDPN形式に含まれる。

<math>
  c ( S ) \coloneqq c _ S
</math>

=== 展開 ===

DPN形式の行列の要素へアクセスする関数。

<math>
  \begin{eqnarray*}
    Z & \coloneqq & z ( S ) \\
    Z & \coloneqq &
      \left (
        \begin{array}{cccc}
          Z _ { 1, 1 } & Z _ { 1, 2 } & \cdots & Z _ { 1, X' } \\
          Z _ { 2, 1 } & Z _ { 2, 2 } & \cdots & Z _ { 2, X' } \\
          Z _ { 3, 1 } & Z _ { 3, 2 } & \cdots & Z _ { 3, X' } \\
        \end{array}
      \right )
    C & \coloneqq & c ( S ) \\
    { d' } _ Z ( x ) & \coloneqq & Z _ { 1, x } \\
    { p' } _ Z ( x ) & \coloneqq & Z _ { 2, x } \\
    { n' } _ Z ( x ) & \coloneqq & Z _ { 3, x } \\
    r _ Z & \coloneqq & p _ 1 \quad ( p = [ p _ 1 ] \frown p _ s ) \\
  \end{eqnarray*}
</math>

良い部分と悪い部分と刈られた部分の分割。

<math>
  \begin{eqnarray*}
    r _ Z & \coloneqq & p _ 1 \quad ( p = [ p _ 1 ] \frown p _ s ) \\
    G _ Z & \coloneqq &
    \left (
      \begin{array}{cccc}
          { Z' } _ { 1, 1 } & { Z' } _ { 1, 2 } & \cdots & { Z' } _ { 1, r _ Z - 1 } \\
          { Z' } _ { 2, 1 } & { Z' } _ { 2, 2 } & \cdots & { Z' } _ { 2, r _ Z - 1 } \\
          { Z' } _ { 3, 1 } & { Z' } _ { 3, 2 } & \cdots & { Z' } _ { 3, r _ Z - 1 } \\
      \end{array}
    \right ) \\
    B _ Z & \coloneqq &
    \left (
      \begin{array}{cccc}
          { Z' } _ { 1, r _ Z - 1 + 1 } & { Z' } _ { 1, r _ Z - 1 + 2 } & \cdots & { Z' } _ { 1, X - 1 } \\
          { Z' } _ { 2, r _ Z - 1 + 1 } & { Z' } _ { 2, r _ Z - 1 + 2 } & \cdots & { Z' } _ { 2, X - 1 } \\
          { Z' } _ { 3, r _ Z - 1 + 1 } & { Z' } _ { 3, r _ Z - 1 + 2 } & \cdots & { Z' } _ { 3, X - 1 } \\
      \end{array}
    \right ) \\
    C _ Z & \coloneqq &
    \left (
      \begin{array}{c}
          { Z' } _ { 1, X } \\
          { Z' } _ { 2, X } \\
          { Z' } _ { 3, X } \\
      \end{array}
    \right ) \\
  \end{eqnarray*}
</math>

（未完成）

=== 解凍 ===

新しい行列の要素へアクセスする部分。

<math>
  \begin{eqnarray*}
    Z' & \coloneqq &
      \left (
        \begin{array}{cccc}
          { Z' } _ { 1, 1 } & { Z' } _ { 1, 2 } & \cdots & { Z' } _ { 1, X' } \\
          { Z' } _ { 2, 1 } & { Z' } _ { 2, 2 } & \cdots & { Z' } _ { 2, X' } \\
          { Z' } _ { 3, 1 } & { Z' } _ { 3, 2 } & \cdots & { Z' } _ { 3, X' } \\
        \end{array}
      \right )
    { d' } _ { Z' } ( x ) & \coloneqq & { Z' } _ { 1, x } \\
    { p' } _ { Z' } ( x ) & \coloneqq & { Z' } _ { 2, x } \\
    { n' } _ { Z' } ( x ) & \coloneqq & { Z' } _ { 3, x } \\
  \end{eqnarray*}
</math>

DPN形式を山へ解凍する部分。

<math>
  \begin{eqnarray*}
    { S' } _ x & \coloneqq & { D' } _ { Z' } ( x, 1 ) \\
    { D' } _ { Z' } ( x, n ) & \coloneqq &
      \begin{cases}
        { D' } _ { Z' } ( x, n ^ + ) + { D' } _ { Z' } ( { P' } _ { Z' } ( x, n ), n ) & ( n < { n' } _ { Z' } ( x ) ) \\
        { d' } _ { Z' } ( x )                                                          & ( n = { n' } _ { Z' } ( x ) ) \\
        0                                                                              & ( n > { n' } _ { Z' } ( x ) ) \\
      \end{cases} \\
    { P' } _ { Z' } ( x, n ) & \coloneqq &
      \begin{cases}
        \mathrm{Idx} ( { p' } _ { Z' } ( x ), 1 + { n' } _ { Z' } ( x ) - n ) & ( n \leq { n' } _ { Z' } ( x ) ) \\
        0                                                                     & ( n >    { n' } _ { Z' } ( x ) ) \\
      \end{cases} \\
    \mathrm{Idx} ( p, n ) & \coloneqq &
      \begin{cases}
        p _ 1                                      & ( p = p _ s \frown [ p _ 2, p _ 1 ] \land n = 1 ) \\
        \mathrm{Idx} ( p _ s \frown [ p _ 2 ], n ) & ( p = p _ s \frown [ p _ 2, p _ 1 ] \land n > 1 ) \\
        p _ 1                                      & ( p =              [ p _ 1 ]                    ) \\
      \end{cases} \\
  \end{eqnarray*}
</math>

展開後の数列。

<math>
  u ( Z' ) \coloneqq ( { S' } _ 1, { S' } _ 2, \ldots, { S' } _ { X' } )
</math>
